<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radha Chant Counter</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0f1020; --bg2:#1a1b3a; --bg3:#261d4d; --accent:#ff55c3; --accent2:#7cf8ff; --glass:rgba(255,255,255,.08);
      --glow1: rgba(255,85,195,.45); --glow2: rgba(124,248,255,.35);
    }
    *{box-sizing:border-box}
    html,body,#root{height:100%}
    body{
      margin:0; color:#e9ecf1; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, #2a1948 0%, transparent 60%),
                  radial-gradient(1000px 600px at 80% 30%, #142a4f 0%, transparent 60%),
                  linear-gradient(135deg,var(--bg1),var(--bg2) 40%,var(--bg3));
      overflow:hidden;
    }
    .bg-animate{
      position:fixed; inset:0; pointer-events:none; z-index:0;
    }
    .bg-animate::before,.bg-animate::after{
      content:""; position:absolute; inset:-30%;
      background: conic-gradient(from 0deg at 50% 50%, transparent 0 40%, rgba(124,248,255,.15) 50%, transparent 60% 100%);
      filter: blur(60px);
      animation: spin 26s linear infinite;
    }
    .bg-animate::after{
      background: conic-gradient(from 180deg at 50% 50%, transparent 0 45%, rgba(255,85,195,.10) 55%, transparent 65% 100%);
      animation-duration: 38s;
      mix-blend-mode: screen;
    }
    @keyframes spin{to{transform: rotate(360deg)}}

    .wrap{
      position:relative; z-index:1;
      min-height:100%; display:grid; place-items:center; padding:24px;
    }

    .card{
      width:min(720px,92vw); padding:28px 28px 32px; border-radius:24px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow:
        0 20px 60px rgba(0,0,0,.45),
        0 0 0 1px rgba(255,255,255,.06) inset,
        0 0 40px 10px var(--glow2);
      position:relative; overflow:hidden;
    }
    .card::before{
      content:""; position:absolute; inset:-2px; border-radius:inherit;
      background: linear-gradient(135deg, rgba(255,85,195,.6), rgba(124,248,255,.6));
      filter: blur(20px); opacity:.15; z-index:-1;
    }

    .title{
      margin:4px 0 6px; text-align:center; font-weight:800; letter-spacing:.6px; font-size:clamp(22px,4vw,28px);
      text-shadow: 0 8px 30px var(--glow2);
    }
    .mantra{
      text-align:center; font-family:"Great Vibes", cursive; font-size: clamp(28px, 6vw, 46px);
      color:#fff; letter-spacing:1px;
      text-shadow: 0 0 18px var(--glow1), 0 0 28px var(--glow2);
      margin: 2px 0 14px;
    }

    .stats{
      display:flex; align-items:center; justify-content:center; gap:22px; margin:8px 0 18px;
    }
    .count{
      font-weight:800; font-size: clamp(38px, 9vw, 68px); line-height:1;
      text-shadow: 0 8px 26px rgba(124,248,255,.25);
    }
    .sub{
      font-size:13px; opacity:.8; margin-top:6px; text-align:center;
    }

    .bigbtn{
      position:relative; display:grid; place-items:center; width:min(380px,78vw); aspect-ratio:1/1;
      margin: 8px auto 10px; border-radius:999px; cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent;
      background: radial-gradient(120% 120% at 30% 30%, rgba(124,248,255,.35), transparent 60%),
                  radial-gradient(120% 120% at 70% 70%, rgba(255,85,195,.35), transparent 60%),
                  linear-gradient(135deg, #1a1f3e 0%, #0f1430 100%);
      border: 2px solid rgba(255,255,255,.18);
      box-shadow:
        0 30px 70px rgba(0,0,0,.55),
        0 0 0 8px rgba(124,248,255,.08),
        0 0 90px 10px var(--glow1);
      transition: transform .08s ease, box-shadow .2s ease;
      overflow:hidden;

      /* Prevent ghost clicks / delays; enables single increment on mobile */
      touch-action: manipulation;
    }
    .bigbtn:active{ transform: scale(.985) translateY(1px)}
    .bigbtn::before{
      content:""; position:absolute; inset:-1px; border-radius:inherit;
      background: radial-gradient(60% 60% at 50% 35%, rgba(255,255,255,.25), transparent 60%);
      mix-blend-mode: overlay; pointer-events:none;
      animation: breathe 3.6s ease-in-out infinite;
    }
    @keyframes breathe{ 0%,100%{opacity:.55} 50%{opacity:.85} }

    .btnText{
      font-family:"Great Vibes", cursive; font-size: clamp(44px, 9vw, 72px);
      line-height:1; color:#fff; text-shadow: 0 0 20px var(--glow2), 0 0 36px var(--glow1);
      transform: translateY(-2px);
    }

    .controls{
      display:flex; justify-content:center; gap:10px; margin: 6px 0 4px; flex-wrap:wrap;
    }
    .ctl{
      padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      color:#eaf7fb; font-weight:600; font-size:14px; cursor:pointer; user-select:none;
      box-shadow: 0 6px 20px rgba(0,0,0,.35);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
    }
    .ctl:active{ transform: translateY(1px) scale(.99) }
    .ctl.secondary{ opacity:.85 }

    .petal{
      position:absolute; width:14px; height:20px; border-radius: 12px 12px 12px 2px/ 12px 12px 2px 12px;
      background: radial-gradient(circle at 35% 35%, #ffd3f0 10%, #ff72c9 60%, #d63aaf 100%);
      box-shadow: 0 2px 10px rgba(255,85,195,.35);
      opacity:.75; filter: blur(.2px);
      animation: floatUp linear infinite;
      transform-origin: center;
    }
    @keyframes floatUp{
      0%{ transform: translateY(110vh) rotate(0deg) translateX(0) scale(1)}
      100%{ transform: translateY(-10vh) rotate(360deg) translateX(20px) scale(1.15)}
    }

    .ripple{
      position:absolute; border-radius:50%; pointer-events:none;
      border:2px solid rgba(255,255,255,.45); transform: translate(-50%,-50%) scale(0.2); opacity:.9;
      animation: ripple .7s ease-out forwards;
    }
    @keyframes ripple {
      to { transform: translate(-50%,-50%) scale(1.6); opacity: 0; }
    }

    canvas#fx{ position:fixed; inset:0; z-index:0; pointer-events:none; }

    .footer{
      text-align:center; opacity:.8; font-size:.9rem; margin-top:12px;
    }
    .link{ color:#b0f6ff; text-decoration: none; border-bottom:1px dashed rgba(176,246,255,.6)}
    .link:focus,.link:hover{ outline:none; text-shadow:0 0 14px var(--glow2) }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useRef, useState } = React;

    function App(){
      const [count, setCount] = useState(() => {
        const saved = localStorage.getItem('radha_count');
        return saved ? parseInt(saved, 10) : 0;
      });
      const [ripples, setRipples] = useState([]);
      const rippleId = useRef(0);
      const btnRef = useRef(null);
      const canvasRef = useRef(null);
      const particlesRef = useRef([]);
      const rafRef = useRef(null);

      // Single audio instance for click sound (served from /public)
      const audioRef = useRef(null);
      useEffect(() => {
        const a = new Audio('/radhe_radhe.mp3');
        a.preload = 'auto';
        a.playbackRate = 1; // adjust if you like
        audioRef.current = a;
      }, []);

      // Persist
      useEffect(()=>{ localStorage.setItem('radha_count', String(count)); },[count]);

      // Canvas loop for particles
      useEffect(()=>{
        const c = canvasRef.current; const ctx = c.getContext('2d');
        function resize(){
          c.width = window.innerWidth; c.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);
        let last = performance.now();
        function loop(now){
          const dt = Math.min((now - last)/1000, 0.033); last = now;
          ctx.clearRect(0,0,c.width,c.height);
          particlesRef.current = particlesRef.current.filter(p => {
            p.vy += 120 * dt; // gravity
            p.vx *= 0.99; p.vy *= 0.99;
            p.x += p.vx * dt; p.y += p.vy * dt;
            p.life -= dt;
            ctx.globalCompositeOperation = 'lighter';
            ctx.globalAlpha = Math.max(p.life / p.max, 0);
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
            g.addColorStop(0, p.c1);
            g.addColorStop(1, p.c2);
            ctx.fillStyle = g;
            ctx.fill();
            return p.life > 0;
          });
          rafRef.current = requestAnimationFrame(loop);
        }
        rafRef.current = requestAnimationFrame(loop);
        return ()=>{ window.removeEventListener('resize', resize); cancelAnimationFrame(rafRef.current); }
      },[]);

      function burstAt(x,y, strong=false){
        const colors = [
          ['rgba(255,85,195,1)','rgba(255,85,195,0)'],
          ['rgba(124,248,255,1)','rgba(124,248,255,0)'],
          ['rgba(255,217,102,1)','rgba(255,217,102,0)']
        ];
        const n = strong ? 60 : 22;
        for(let i=0;i<n;i++){
          const a = Math.random()*Math.PI*2;
          const sp = strong ? (140 + Math.random()*180) : (90 + Math.random()*130);
          const r = 2 + Math.random()*3.5;
          const pair = colors[Math.floor(Math.random()*colors.length)];
          particlesRef.current.push({
            x, y,
            vx: Math.cos(a)*sp,
            vy: Math.sin(a)*sp - (strong ? 80 : 40),
            r, c1:pair[0], c2:pair[1],
            life: strong ? 1.2 : 0.8, max: strong ? 1.2 : 0.8
          });
        }
      }

      function vibrate(ms=15){
        try{ navigator.vibrate && navigator.vibrate(ms); }catch(e){}
      }

      // Play audio from public/radhe_radhe.mp3 on each tap
      function playRadhe(){
        const a = audioRef.current;
        if(!a) return;
        try{
          // restart the short clip so rapid taps feel snappy
          a.pause();
          a.currentTime = 0;
          const p = a.play();
          if (p && typeof p.catch === 'function') p.catch(()=>{ /* ignore blocked play */});
        }catch(e){}
      }

      function handleTap(ev){
        ev.preventDefault?.();

        // ignore non-left clicks
        if (ev.button !== undefined && ev.button !== 0) return;

        const rect = btnRef.current.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        const x = (ev.clientX ?? cx);
        const y = (ev.clientY ?? cy);

        // Ripple
        const id = rippleId.current++;
        const size = Math.max(rect.width, rect.height) * 0.9;
        setRipples(rs => [...rs, { id, x, y, size }]);
        setTimeout(()=> setRipples(rs => rs.filter(r => r.id !== id)), 700);

        // Effects + count + sound
        burstAt(x,y, (count+1) % 108 === 0); // big at every 108
        vibrate();
        setCount(c => c + 1);
        playRadhe();
      }

      function reset(){
        if(confirm('Reset your Radha count to 0?')){
          setCount(0);
          burstAt(window.innerWidth/2, window.innerHeight/2, true);
        }
      }
      function minusOne(){
        setCount(c => Math.max(0, c-1));
      }

      // Generate floating petals
      const petals = Array.from({length: 24}, (_,i)=> {
        const left = Math.random()*100;
        const delay = (Math.random()*18).toFixed(2);
        const duration = (22 + Math.random()*18).toFixed(2);
        const scale = (0.7 + Math.random()*0.8).toFixed(2);
        const rotate = Math.floor(Math.random()*360);
        return (
          <span
            key={'p'+i}
            className="petal"
            style={{
              left: left+'%',
              animationDuration: duration+'s',
              animationDelay: -delay+'s',
              transform: `translateY(110vh) rotate(${rotate}deg) scale(${scale})`
            }}
            aria-hidden="true"
          />
        );
      });

      const malas = Math.floor(count / 108);
      const bead = count % 108;

      return (
        <>
          <canvas id="fx" ref={canvasRef} />
          <div className="bg-animate" aria-hidden="true"></div>
          <div className="wrap">
            <div className="card" role="article" aria-label="Radha chanting counter">
              <h1 className="title">Radha Chant Counter</h1>
              <div className="mantra">राधे राधे ✨</div>

              <div className="stats" aria-live="polite">
                <div style={{textAlign:'center'}}>
                  <div className="count" title="Total Count">{count.toLocaleString()}</div>
                  <div className="sub">Total Chants</div>
                </div>
                <div style={{opacity:.7}}>|</div>
                <div style={{textAlign:'center'}}>
                  <div className="count" style={{fontSize:'clamp(26px,6.5vw,40px)'}} title="Beads (toward 108)">
                    {bead}/108
                  </div>
                  <div className="sub">Current Mala Bead</div>
                </div>
                <div style={{opacity:.7}}>|</div>
                <div style={{textAlign:'center'}}>
                  <div className="count" style={{fontSize:'clamp(26px,6.5vw,40px)'}} title="Completed Malas">
                    {malas}
                  </div>
                  <div className="sub">Completed Malas</div>
                </div>
              </div>

              <div
                ref={btnRef}
                className="bigbtn"
                role="button"
                aria-label="Tap to chant Radha and increase the counter"
                onPointerDown={handleTap}
              >
                <div className="btnText">Radha</div>

                {ripples.map(r => (
                  <span key={r.id} className="ripple" style={{ left:r.x+'px', top:r.y+'px', width:r.size+'px', height:r.size+'px' }} />
                ))}
              </div>

              <div className="controls">
                <button className="ctl" onClick={minusOne} title="Undo last tap">−1</button>
                <button className="ctl secondary" onClick={reset} title="Reset counter">Reset</button>
              </div>

              <div className="footer">
                Tip: Every 108th chant triggers a bigger celebration 🎉
              </div>

              {petals}
            </div>
          </div>
        </>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
